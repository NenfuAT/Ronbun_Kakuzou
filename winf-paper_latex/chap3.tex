\section{ウェアラブルデバイスの回転量と移動距離の推定}
図\ref{fig:1}に本研究の全体像を示す．
各節では全体像内の「データの収集」「データの分析」「データの可視化」について述べる.

本研究ではウェアラブルデバイスとしてスマートウォッチを使用した.
1章で述べたようにウェアラブルデバイスの中にはセンサグローブやセンサリングなども存在している.
指先の動作まで取得可能なセンサグローブが理想である.しかし,一般的に普及しており料理という環境から防水性のあるスマートウォッチを採用した.
また,カメラを使わない理由としては,調理動作中の手の動きは立体的な動きであるため,複数視点から撮影を行う必要があるためである.

先行研究\cite{kumazawaanalysis}では加速度のみを用いて推定するものもあるが,推定できる動作がかなり限定的である.
そこで加速度・角速度を組み合わせて,端末の回転量や移動を算出し調理技能の分析に使用する.

\figimage{images/fig1.pdf}{80}{本研究の概要図}{fig:1}

\subsection{データの収集}
スマートウォッチでセンシングを行うアプリを自作し取得した加速度・角速度を使用して推定を行う.
基本的な包丁の握り方では図\ref{fig:2}のようにウォッチの向きと包丁の刃の向きが一致する.
\figimage{images/fig2.pdf}{80}{スマートウォッチと刃の向きの相関}{fig:2}
そこで収集するデータとしては,包丁を持つ側の手首の動きをセンシングしたものを収集する.
収集したデータは今後使用しやすいようにネットワークを介してオブジェクトストレージサーバーへ蓄積する仕組みとなっている.
\subsection{データの分析}
本節ではオブジェクトストレージサーバーから呼び出したデータを用いた端末の回転量と移動の推定について述べる.

今回は角速度と加速度にMadgwickフィルタを用いてセンサフージョンを行い回転量をクォータニオンとして導出している.
他の候補としてカルマンフィルタがあるが,モデルの構造が不明な場合に高精度を実現するのが難しい.
Madgwickフィルタは,事前に求めておくべきパラメータが少なく処理が高速な特徴がある.
そのため計算速度の観点からMadgwickフィルタを採用した.

クォータニオンとは回転の量を表すもので,オイラー角や回転行列と相互に変換可能であり,
上下がわからなくなるジンバルロックという現象が発生しない特徴がある.
求めた回転量を使用して重力加速度を導出し,加速度から重力加速度を取り除き線形加速度を導出している.
しかしこのままでは相対座標に基づいた移動なので,端末の姿勢を変化させながら動かすと異なる座標軸での移動と検出される.
そこで次の式を用いて変換を行う.
\[
\mathbf{a}_{\text{絶対}} = \mathbf{q} \cdot \mathbf{a}_{\text{相対}} \cdot \mathbf{q}^{-1}
\]
絶対座標へ変換すると端末の姿勢が変化した際にも同じ方向に対する移動として検出可能となる.
求めた絶対座標での線形加速度を二重積分して移動距離を導出している.
しかし,このままでは積分により図\ref{fig:3}のように誤差が蓄積しており正しい移動距離が推定できていない.
\figimage{images/fig3.pdf}{80}{積分による誤差と誤差の軽減}{fig:3}
そこでハイパスフィルタを用いて,積分誤差の軽減をしている.
角度については次の式をもとにクォータニオンから変換を行なっている.
    \[
	\text{Roll} = \tan^{-1}\left( \frac{2(w x + y z)}{1 - 2(x^2 + y^2)} \right)
	\]
	\[
	\text{Pitch} = \sin^{-1}\left( 2(w y - z x) \right)
	\]
	\[
	\text{Yaw} = \tan^{-1}\left( \frac{2(w z + x y)}{1 - 2(y^2 + z^2)} \right)
	\]
Roll・Pitch・YawがそれぞれX軸・Y軸・Z軸の角度を表している.
図\ref{fig:2}のように端末と包丁の動作は連動しているため,本推定手法により包丁の移動・角度を求められる.

\subsection{データの可視化}
分析されたデータを比較し，結果を表示する．過去の自分や他者との比較から調理技能の向上を目指す.
比較について,切る工程を例に述べる．特徴量として切った回数・
切るペース・包丁を入れた角度などがある．切った回数が他の人
より多い場合は切った物の幅が小さい可能性があり，逆に少な
い場合は幅が大きい可能性がある．切る
ペースが他より早い場合は手際が良い,逆に遅い場合は手際が悪いと
考えられる．包丁を入れた角度からは,切った対象の断面の面積に関係している可能性があり,切る際の重要な要素の一つであると考えられる.
このように複数のデータから調理技能の比較を行う．
利用者は比較結果から数値化された自身の調理技能や改善点がわ
かり，今後の調理技能の向上を促進する.結
果の表示方法については特徴量別に順位をつけるものや個別での
比較などが考えられる．今後他の方法がないかを検討する必要が
ある．
